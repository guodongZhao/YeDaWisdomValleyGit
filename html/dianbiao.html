<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no"><!-- 禁止IPHONE识别手机号码 -->
<meta name="viewport" content="width=device-width,user-scalable=no, initial-scale=1">
<title>访客</title>
<!-- css -->
<link rel="stylesheet" type="text/css" href="../css/frozenui.css">
<link rel="stylesheet" type="text/css" href="css/index.css">
<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
<link href="css/foundation-datepicker.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="../css/aui.css">

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/aui-toast.js"></script>
<script type="text/javascript" src="../script/H.js"></script>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/yuming.js"></script>
<style>
.module-content{padding-top: 44px;padding-bottom: 50px;}
.fklist{margin: 10px;}
.fklist li{background: #fff;border-radius:5px;padding: 10px;margin-bottom: 10px;position: relative;}
.fklist li a{display: flex;justify-content: space-between;}
.fklist li span{width: 50px;font-size: 14px;}
.fklist li h3{font-size: 14px;color: #000;margin-bottom: 10px;width: 100%;}
.fklist li h4{color: #666;font-size: 12px;}
.fklist li p{color: #999;font-size: 12px;border-top: 1px solid #f1f1f1;margin-top: 10px;padding-top: 10px;}
.tianjia{position: fixed;right: 10px;width: 36px;height: 36px;bottom: 65px;}
.tianjia img{width: 100%;}
.zhuan{
	display: none;
	margin: 0 auto;
}
#ding{
  width: 100%;
  height: 50px;
  background: white;
  position: relative;
  line-height: 50px;
  box-sizing: border-box;
  display: flex;
}
.ding{
  flex: 1;
  font-size: 14px;
  text-align: center;
  position: relative;
}
.ding1{
width: 20px;height: 2px;
position: absolute;
left: 50%;
margin-left: -10px;
bottom: 8px;
background:#4989F6;
display: none;
}
.ww{width: 100%; display: flex;justify-content: space-between;align-items: center; color: #666;font-size: 12px;}
.ww p{display: flex;justify-content: space-between; color: #999;font-size: 12px;border-top: 1px solid #f1f1f1;margin-top: 10px;padding-top: 10px;}

.dingac{
  color: #4989F6;
}
.dingac .ding1{
  display: block;
}
.ks{
  position: absolute;
  width: 100px;
  bottom: 12px;
  left: 100px;
  height: 30px;
  line-height: 30px;
  font-size: 12px;
}
.ks input{
  position: absolute;
  height: 20px;
  line-height: 20px;
  font-size: 12px;
  color: #464646;
  left: 50px;
  top: 5px;
  outline: none;
  border: none;
  padding: 0;
  text-indent: 0;
  background: rgba(0,0,0,0)
}
.js input{
  position: absolute;
  height: 20px;
  line-height: 20px;
  font-size: 12px;
  color: #464646;
  left: 50px;
  top: 5px;
  outline: none;
  border: none;
  padding: 0;
  text-indent: 0;
  background: rgba(0,0,0,0)
}
.js{  height: 30px;  line-height: 30px;  font-size: 12px;
  position: absolute;
  width: 100px;
  bottom: 12px;
  left: 230px;
}
.dj{
  text-align:right;width:60px;height:20px;position:absolute;right:10px;top:10px;line-height:20px;
}


.qd{
  height: 40px;
  width: 100%;
  position: relative;
  line-height: 40px;
  font-size: 14px;
  text-align: center;
  color: #464646;
  border-top: 0.5px solid #EDEDED;
}
.qd1{
  width: 50%;
  height: 40px;
  position: absolute;
  left: 0;
  bottom: 0;
    border-right: 0.5px solid #EDEDED;
}
.qd2{
  width: 50%;
  height: 40px;
  position: absolute;
  right: 0;
  bottom: 0
}
#bz,#bz2{
  width: 90%;
  height: 50px;
  line-height: 50px;
  font-size: 14px;
  color: #464646;
  display: block;
  margin: 0 auto;
  border: none;
  position: relative;
  top: -15px;
}
.tg{
  height: 20px;
  line-height: 20px;
  font-size: 14px;
    width: 35px!important;
  position: absolute;
  right: 10px;
  bottom: 10px;
text-align:right;

}
.jj{
  height: 20px;
  line-height: 20px;
  font-size: 14px;
  width: 35px!important;
  position: absolute;
  right: 50px;
  bottom: 10px;
  text-align:right;

}
.sb1{
  position: absolute;
  width: 60px;
  bottom: 12px;
  left: 100px;
  height: 30px;
  line-height: 30px;
  font-size: 12px;
}
.sb1 input{
  position: absolute;
  width: 40px;
  height: 12px;
  line-height: 12px;
  font-size: 12px;
  color: #4083F6;
  left: 20px;
  top: 9px;
  outline: none;
  border: none;
  padding: 0;
  text-indent: 0;
  background: rgba(0,0,0,0);
  border-radius: 0;
}
.sb2{
  position: absolute;
  width: 50px;
  bottom: 12px;
  left: 160px;
  height: 30px;
  line-height: 30px;
  font-size: 12px;
}
.sb2 input{
  position: absolute;
  width: 30px;
  height: 12px;
  line-height: 12px;
  font-size: 12px;
  color: #4083F6;
  left: 20px;
  top: 9px;
  outline: none;
  border: none;
  padding: 0;
  text-indent: 0;
  background: rgba(0,0,0,0);
  border-radius: 0;
}
.sb3{
  position: absolute;
  width: 85px;
  bottom: 12px;
  left: 220px;
  height: 30px;
  line-height: 30px;
  font-size: 12px;
}
.sb3 input{
  position: absolute;
  width: 30px;
  height: 12px;
  line-height: 12px;
  font-size: 12px;
  color: #4083F6;
  left: 55px;
  top: 9px;
  outline: none;
  border: none;
  padding: 0;
  text-indent: 0;
  background: rgba(0,0,0,0);
  border-radius: 0;
}
#sou{
  height: 24px;
  line-height: 24px;
  font-size: 14px;
  text-align: center;
  width: 50px;
  position: absolute;
  right: 5%;
  bottom: 16px;
color: white;
background: #4083F6;
border-radius: 4px;
}
.tianjia{position: fixed;right: 10px;width: 36px;height: 36px;bottom: 65px;}
.tianjia img{width: 100%;}
</style>
</head>
<body style="background: #f7f7f7;">
  <div class="ui-dialog" id="dialog">
          <div class="ui-dialog-cnt">
              <div class="ui-dialog-bd">
                  <p>确定要通过审核吗？</p>
              </div>
 <input type="text" name="" placeholder="备注" id="bz">
              <div class="qd">
                <div class="qd1" onclick="quxiao()">
取消
                </div>
                <div class="qd2"  onclick="queding()">
确定
                </div>
              </div>
          </div>
      </div>
      <div class="ui-dialog" id="dialog2">
              <div class="ui-dialog-cnt">
                  <div class="ui-dialog-bd">
                      <p>确定要拒绝吗？</p>
                  </div>
     <input type="text" name="" placeholder="备注" id="bz2">
                  <div class="qd">
                    <div class="qd1" onclick="quxiao2()">
    取消
                    </div>
                    <div class="qd2"  onclick="queding2()">
    确定
                    </div>
                  </div>
              </div>
          </div>
	<header id="headj">
		<a >
			<img src="images/back_jt.png" onclick="api.closeWin()" />
			<span onclick="api.closeWin()">电表读数</span>
      <div class="ks" style="display:none">
        开始日期 <input type="date" name="" id="ksdate">
      </div>
      <div class="js" style="display:none">
        截止日期 <input type="date" name="" id="jsdate">
      </div>
		</a>
		<div class="sb1" style="display:none">
			年 <input type="number" name="" id="nian" placeholder="全部">
		</div>
		<div class="sb2"  style="display:none">
			月 <input type="number" name="" id="yue" placeholder="全部">
		</div>
		<div class="sb3"  style="display:none">
			设备序号 <input type="number" name="" id="xuhao" placeholder="全部">
		</div>
		<div id="sou"  style="display:none">
			搜索
		</div>
		<img src="./images/search.png" id="jgsou" style="height:20px;width:20px;position:absolute;right:5%;bottom:15px;">
	</header>
<div class="module-content" id="ge">
  <div id="ding"  style="display:none">
    <div class="ding dingac" onclick="renwu(1,this)">
      我的流程
      <div class="ding1">

      </div>
    </div>
    <div class="ding " onclick="renwu(2,this)">
      待办任务
      <div class="ding1">

      </div>
    </div>
    <div class="ding " onclick="renwu(3,this)">
      已办任务
      <div class="ding1">

      </div>
    </div>
  </div>
	<ul class="fklist" id="jmenjin">
		<!--<li><a href="#">
			<div>
				<h3>业达物业集团</h3>
				<h4>王经理</h4>
			</div>
			<span style="color: #00B168;">已通过</span>
		</a>
		<p>2019-12-12</p>
		</li>
		<li><a href="#">
			<div>
				<h3>业达物业集团</h3>
				<h4>王经理</h4>
			</div>
			<span style="color: #FF3A5F;">待审核</span>
		</a>
		<p>2019-12-12</p>
		</li>
		<li><a href="#">
			<div>
				<h3>业达物业集团</h3>
				<h4>王经理</h4>
			</div>
			<span style="color: #007AFF;">已结束</span>
		</a>
		<p>2019-12-12</p>
	</li>-->
	</ul>
</div>
<img src="../image/zhuan.gif" id="zhuan" style="height:20px;width:auto;margin-top:10px;margin-bottom:10px;" class="zhuan">
<div id="ddd">

</div>
<a class="tianjia" onclick="opw('dianbiaoxin',1)"><img src="images/ad.png" /></a>
<div class="foot_menu" style="display:none">
	<ul>
		<li>
			<a href="index.html">
				<i><img src="images/menu_icon01.png"></i>
				<span>首 页</span>
			</a>
		</li>
		<li class="cur">
			<a href="shequ.html">
				<i><img src="images/menu_icon02_r.png"></i>
				<span>社 区</span>
			</a>
		</li>
		<li>
			<a href="news.html">
				<i><img src="images/menu_icon03.png"></i>
				<span>消 息</span>
			</a>
		</li>
		<li>
			<a href="user.html">
				<i><img src="images/menu_icon04.png"></i>
				<span>我 的</span>
			</a>
		</li>
	</ul>
</div>
</body>
</html>
<script type="text/javascript">
arr=[]
page=0
type=1
ksdate=''
jsdate=''
nian=''
yue=''
xuhao=''
apiready = function () {
$api.fixStatusBar(document.getElementById('headj'));
document.getElementById('headj').style.height=(50+api.safeArea.top)+'px'
document.getElementById('ge').style.marginTop=(5+api.safeArea.top)+'px'
api.addEventListener({
    name: 'sxrw'
}, function(ret, err){
  showDefault()
	page=0;
	zb()
});
document.getElementById('jgsou').onclick=function(){
	api.openWin({
	    name: 'sousb',
	    url: './sousb.html',
	    pageParam: {
	        tp:2
	    }
	});

}
document.getElementById('nian').onchange=function(){
nian=document.getElementById('nian').value

}
document.getElementById('yue').onchange=function(){
  yue=document.getElementById('yue').value
}
document.getElementById('xuhao').onchange=function(){
  xuhao=document.getElementById('xuhao').value
}
document.getElementById('sou').onclick=function(){
	showDefault()
	page=0;
	zb()
}
    // $("#dialog").addClass("show");
/*获取当前时间*/
   var time = new Date();
   /*格式化日，如果小于9，则补0*/
   var day = ("0" + time.getDate()).slice(-2);
   /*格式化月，如果小于9，则补0*/
   var month = ("0" + (time.getMonth() + 1)).slice(-2);
   /*拼接日期*/
   var today = time.getFullYear() + "-" + (month) + "-" + (day);
   /*完成赋值操作*/
   ksdate=today
   jsdate=today
   document.getElementById("ksdate").value=today
   document.getElementById("jsdate").value=today
  // alert( document.getElementById("jsdate").value)
$api.setStorage('j',0)
showDefault()
api.addEventListener({
    name: 'sx'
}, function(ret, err){
  showDefault()
  zb()
});

/*
请求地址：/learun/adms/watermeter/watermetershow类型：GET
请求参数：
参数名称	类型	备注	必须
loginMark	String	设备标识，必须具有唯一性	是
token	String	验证码，从登录后返回信息中获取	是
page	Int	页码	是
rows	Int	每页显示数量	是
id	  Int	序号
year	String	年	否
month	String	月	否
deviceid	int	设备序号	否
*/

function zb(){
	if(api.pageParam.id){
		xuhao=api.pageParam.id
	}
	if(api.pageParam.nian){
	nian=api.pageParam.nian
	}
	if(api.pageParam.yue){
		yue=api.pageParam.yue
	}
page++
if(page==1){
//alert(riqi)

 api.ajax({
	 url: yuming+'/learun/adms/Electricitymeter/electricitymetershow',
			 method: 'get',
			 data:{values: {


"loginMark": api.deviceId,
"token": $api.getStorage('token'),
page:page,
rows:10,
id:'',
year:nian,
month	:yue,
deviceid:xuhao
						 }}
			}, function(ret) {
//alert(JSON.stringify(ret))
api.refreshHeaderLoadDone()
				for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
				 document.getElementsByClassName('zhuan')[i].style.display='none'
			 }
			 if(ret){
			 if(1){


if(ret.data.list.length>0){
var html='';
for (var i = 0; i <ret.data.list.length; i++) {
	html+='<li  onclick="fwxq('+ret.data.list[i].id+')" style="width:100%"><a >'
	html+=	'	<div style="width:100%">'
	html+=	'	<h3 >设备序号:'+ret.data.list[i].deviceid

	html+='</h3>'

	html+=	'	<div class="ww"><span style="width:50%">电表读数:'+ret.data.list[i].dvalue+'</span>'
	if(ret.data.list[i].newvalue){  html+=	'<span style="width:50%;text-align:right">本次表读数:'+ret.data.list[i].newvalue+'</span>'}else {
	 html+=	'<span style="width:50%;text-align:right">本次表读数:</span>'
	}
	html+='</div>'
	if(ret.data.list[i].remark){      html+=	'	<h4>备注:'+ret.data.list[i].remark+'</h4>'}
	if(ret.data.list[i].status==1){    html+='<span style="color:#62E54D;" class="dj"><span style="color:black;">状态:</span>正常<span>'}



	if(ret.data.list[i].status==0){    html+='<span style="color:#F2B721;" class="dj"><span style="color:black;">状态:</span>异常<span>'}
	 html+='</div>'
	//html+=	'	<span style="color: #00B168;">已通过</span>'
	html+='	</a>'
	html+=	'<p>'+ret.data.list[i].year+'-'+ret.data.list[i].month+'-'+ret.data.list[i].day
	if(0){    html+='<span style="color:#F54831;" class="vv jj" onclick="jujue(this)" data-id="'+ret.data.list[i].F_TaskId+'"  >拒绝</span><span style="color:#62E54D;" onclick="tongguo(this)" data-id="'+ret.data.list[i].F_TaskId+'"  class="vv tg">通过</span>'}
	html+='</p>'
	html+='	</li>'
}
html+='<div class="xiala"></div>'
document.getElementById('jmenjin').innerHTML=html;
$('.vv').click(function(e){

　　e.stopPropagation();

})
}else {
 document.getElementById('jmenjin').innerHTML='<img src="../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:160px;margin-bottom:100px;">'
}

			 }else {

		 toast.hide()
			 }


		 }else {

			/* api.toast({
			 msg: '网络错误',
			 duration: 2000,
			 location: 'middle'
	 });*/
		 }
toast.hide()
			})
}else {
 api.ajax({
	 url: yuming+'/learun/adms/Electricitymeter/electricitymetershow',
			method: 'get',
			data:{values: {


"loginMark": api.deviceId,
"token": $api.getStorage('token'),
page:page,
rows:10,
id:'',
year:nian,
month	:yue,
deviceid:xuhao
					}}
}, function(ret) {
				for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
				 document.getElementsByClassName('zhuan')[i].style.display='none'
			 }
			 if(ret){
			 if(1){


         if(ret.data.list&&ret.data.list.length>0){
         var html='';
         for (var i = 0; i <ret.data.list.length; i++) {
					 html+='<li  onclick="fwxq('+ret.data.list[i].id+')" style="width:100%"><a >'
 				html+=	'	<div style="width:100%">'
 				 html+=	'	<h3 >设备序号:'+ret.data.list[i].deviceid

 				 html+='</h3>'

 				 html+=	'	<div class="ww"><span style="width:50%">电表读数:'+ret.data.list[i].dvalue+'</span>'
 				 if(ret.data.list[i].newvalue){  html+=	'<span style="width:50%;text-align:right">本次表读数:'+ret.data.list[i].newvalue+'</span>'}else {
 					 html+=	'<span style="width:50%;text-align:right">本次表读数:</span>'
 				 }
 				html+='</div>'
 				if(ret.data.list[i].remark){      html+=	'	<h4>备注:'+ret.data.list[i].remark+'</h4>'}
 				if(ret.data.list[i].status==1){    html+='<span style="color:#62E54D;" class="dj"><span style="color:black;">状态:</span>正常<span>'}



 				if(ret.data.list[i].status==0){    html+='<span style="color:#F2B721;" class="dj"><span style="color:black;">状态:</span>异常<span>'}
 					 html+='</div>'
 				//html+=	'	<span style="color: #00B168;">已通过</span>'
 				html+='	</a>'
 				html+=	'<p>'+ret.data.list[i].year+'-'+ret.data.list[i].month+'-'+ret.data.list[i].day
 				if(0){    html+='<span style="color:#F54831;" class="vv jj" onclick="jujue(this)" data-id="'+ret.data.list[i].F_TaskId+'"  >拒绝</span><span style="color:#62E54D;" onclick="tongguo(this)" data-id="'+ret.data.list[i].F_TaskId+'"  class="vv tg">通过</span>'}
 				html+='</p>'
 				html+='	</li>'
         }

html+='<div class="xiala"></div>'
document.getElementsByClassName('xiala')[page-2].innerHTML=html
	$api.setStorage('j',0)
  $('.vv').click(function(e){

  　　e.stopPropagation();

  })
}else {
 //document.getElementById('content').innerHTML='<img src="../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:100px;">'
}

			 }


		 }else {

			/* api.toast({
			 msg: '网络错误',
			 duration: 2000,
			 location: 'middle'
	 });*/
		 }
toast.hide()
			})


}

}
zb()
api.addEventListener({
name:'scrolltobottom',
extra:{
		threshold:0           //设置距离底部多少距离时触发，默认值为0，数字类型
}
}, function(ret, err){

if($api.getStorage('j')==0){
$api.setStorage('j',1)
//alert(1)
 var zhuan=document.getElementById('zhuan').cloneNode(true);
 zhuan.style.display='block'
 document.getElementById('ddd').appendChild(zhuan)

zb()
}
});


}
function fwxq(data){
	//alert(JSON.stringify(arr[data]))
	api.openWin({
	    name: 'dianbiaoxq',
	    url: './dianbiaoxq.html',
	    pageParam: {
	      id:data
	    }
	});

}

</script>
