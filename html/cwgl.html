<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no"><!-- 禁止IPHONE识别手机号码 -->
    <meta name="viewport" content="maximum-scale=1.0,minimum-scale=1.0,user-scalable=0,width=device-width,initial-scale=1.0"/>
<title>一停车场</title>
<!-- css -->
  <link rel="stylesheet" type="text/css" href="../css/frozenui.css"/>
    <link rel="stylesheet" type="text/css" href="../css/api.css"/>
<link rel="stylesheet" type="text/css" href="css/index.css">
<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
<link rel="stylesheet" type="text/css" href="../css/aui.css">
<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/aui-toast.js"></script>
<script type="text/javascript" src="../script/H.js"></script>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/yuming.js"></script>
<style>
.module-content{padding-top: 44px;margin-bottom: 50px;}
.slideTxtBox .hd ul{width: 50%;margin: 10px auto;display: flex;justify-content: space-around;}
.slideTxtBox .hd ul li{text-align: center;font-size: 14px;}
.slideTxtBox .hd ul li p{width: 20px;height: 2px;margin: auto;margin-top: 6px;}
.slideTxtBox .hd ul li.on{color: #007AFF;}
.slideTxtBox .hd ul li.on p{background: #007AFF;}

.slideTxtBox .bd{border-top: 10px solid #f9f9f9;}
.tcw{padding: 10px;}
.tcw li{border-bottom: 1px solid #f1f1f1;padding: 10px;}
.tcw li div{display: flex;justify-content: space-between;line-height: 22px; font-size: 14px;}
.tcw li p{font-size: 12px;}
.zhuan{
  display: none;
  margin: 0 auto;
}
.tianjia{position: fixed;right: 10px;width: 36px;height: 36px;bottom: 65px;}
.tianjia img{width: 100%;}
#sou{
	height: 30px;
	line-height: 30px;
	position: absolute;
	width: 80%;
	right: 10%;
	bottom: 14px;
	font-size: 14px;
	border-radius: 15px;
  text-indent: 10px;
  font-size: 14px;
  background: #EEF2FB;
  border: none;
}
#sout{
	height: 20px;
width: 20px;;
	position: absolute;

	right: 4%;
	bottom: 18px;
}
.del{
  position: absolute;
  right: 10px;
  bottom: 10px;
  z-index: 1;
  height: 26px;
  display: block;
}
.qd{
  height: 40px;
  width: 100%;
  position: relative;
  line-height: 40px;
  font-size: 14px;
  text-align: center;
  color: #464646;
  border-top: 0.5px solid #EDEDED;
}
.qd1{
  width: 50%;
  height: 40px;
  position: absolute;
  left: 0;
  bottom: 0;
    border-right: 0.5px solid #EDEDED;
}
.qd2{
  width: 50%;
  height: 40px;
  position: absolute;
  right: 0;
  bottom: 0
}
</style>
</head>
<body>
  <div class="ui-dialog" id="dialog">
					<div class="ui-dialog-cnt">
							<div class="ui-dialog-bd">
									<p>确定要删除吗？</p>
							</div>

							<div class="qd">
								<div class="qd1" onclick="quxiao()">
取消
								</div>
								<div class="qd2"  onclick="queding()">
确定
								</div>
							</div>
					</div>
			</div>
	<header id="headj">
		<a >
			<img src="images/back_jt.png" onclick="api.closeWin()" />
			<span onclick="api.closeWin()" id="tname" style="opacity:0">车位管理</span>
		</a>
    <div>
      <input type="text" placeholder="请输入车位名称" id="sou" />
      <img src="images/search.png" id="sout"/>
    </div>
	</header>
<div class="module-content slideTxtBox" id="ge">
	<div class="hd" style="display:none">
		<ul>
			<li class="on">可用<p></p></li>
			<li>已用<p></p></li>
		</ul>
	</div>
	<div class="bd">
		<ul class="tcw" id="jzuo" style="display:block">
	<!--		<li>
				<div><span>楼层：b1</span><span>车位号：258</span></div>
				<div>业达智慧园区一停车场</div>
			</li>
-->
		</ul>
		<ul class="tcw" id="jyou">
<!--			<li>
				<div><span>楼层：b1</span><span>车位号：258</span></div>
				<div>业达智慧园区一停车场</div>
				<p>车牌号：鲁Y 525v5</p>
			</li>
-->

		</ul>
	</div>
</div>
<img src="../image/zhuan.gif" id="zhuan" style="height:20px;width:auto;margin-top:10px;margin-bottom:10px;" class="zhuan">
<div id="ddd">

</div>
<a class="tianjia" onclick="opw('cwgladd',1)" style="z-index:666"><img src="images/ad.png"  style="z-index:666"/></a>
<div class="foot_menu" style="display:none">
	<ul>
		<li>
			<a href="index.html">
				<i><img src="images/menu_icon01.png"></i>
				<span>首 页</span>
			</a>
		</li>
		<li class="cur">
			<a href="shequ.html">
				<i><img src="images/menu_icon02_r.png"></i>
				<span>社 区</span>
			</a>
		</li>
		<li>
			<a href="news.html">
				<i><img src="images/menu_icon03.png"></i>
				<span>消 息</span>
			</a>
		</li>
		<li>
			<a href="user.html">
				<i><img src="images/menu_icon04.png"></i>
				<span>我 的</span>
			</a>
		</li>
	</ul>
</div>
</body>
<script type="text/javascript" src="js/jquery.js" ></script>
<script type="text/javascript" src="js/jquery.SuperSlide.2.1.1.js" ></script>
<script>
	$(".slideTxtBox").slide({trigger:"click"});
</script>
</html>
<script type="text/javascript">
page=0;
str=''
arr=[]
arrindex=0
apiready = function () {
$api.fixStatusBar(document.getElementById('headj'));
document.getElementById('headj').style.height=(50+api.safeArea.top)+'px'
document.getElementById('ge').style.marginTop=(5+api.safeArea.top)+'px'
api.addEventListener({
    name: 'sx'
}, function(ret, err){
page=0
showDefault()
zb()
});

document.getElementById('sou').oninput=function(){//alert(str)
str=document.getElementById('sou').value

}
document.getElementById('sout').onclick=function(){
showDefault()
page=0
zb()
}
$api.setStorage('j',0)
showDefault()
function zb(){
/*
：/learun/adms/ParkingManagement/getparkinglist
类型：Get
请求参数：
参数名称	类型	备注	必须
loginMark	String	设备标识，必须具有唯一性	是
token	String	验证码，从登录后返回信息中获取	是
pageno	String	当前页码	是
pagesize	String	每页记录数	是
name	String	车位名称，不填写名称查询全部
返回参数：
参数名称	类型	备注
code	String	结果响应码
info	String	结果响应信息
data	String	返回值
Data主要属性
参数名称	类型	备注
pageno	String	当前页码
pagesize	String	每页记录数
total	String	总记录数
list	List<Map>	列表
List主要属性
参数名称	类型	备注
id	string	id
companyid	string	数据区分序号
name	string	车位名称
parkingstatusid	int	车位状态1.闲置2.租赁
remark	String	备注
*/
page++
//alert(str)
if(page==1){
//alert(riqi)

 api.ajax({
   url: yuming+'/learun/adms/ParkingManagement/getparkinglist',
       method: 'get',
       data:{values: {
         "loginMark": api.deviceId,
         "token": $api.getStorage('token'),

         pageno	:page,
         pagesize	:20,
         name:str
             }}
      }, function(ret) {
//alert(JSON.stringify(ret))
api.refreshHeaderLoadDone()
        for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
         document.getElementsByClassName('zhuan')[i].style.display='none'
       }
       if(ret){
       if(ret.code==200){
         arr=[]
         arrindex=0
document.getElementById('jzuo').innerHTML=''
if(ret.data.list.length>0){
var html='';
for (var i = 0; i <ret.data.list.length; i++) {
//  ' <div class="d" onclick="sjxq(1)">'+
arr.push(ret.data.list[i])
arrindex++
  if(1){
     html= '	<li onclick="cwxq('+arrindex+')" style="position:relative;">'+
				'<div><span>'+ret.data.list[i].name+'</span>'
  if(ret.data.list[i].parkingstatusid==1){  html+=    '<span style="color:#62E54D;">闲置</span></div>'}else {
    html+=    '<span style="color:#F2B721;" >租赁</span></div>'
  }
			html+='	<div>'+ret.data.list[i].remark+'</div>'
      	html+='	<div style="width:100%;height:30px;position:relative"></div>'
       	html+='	<img src="images/del.png" class="del vv" data-id="'+ret.data.list[i].id+'" onclick="shanchu('+ret.data.list[i].id+')" />'
			html+=	'</li>'
      $('#jzuo').append(html)
      $('.vv').click(function(e){

      　　e.stopPropagation();

      })
    }else {
      html= '	<li>'+
      '<div><span>楼层：'+ret.data.list[i].floorName+'</span><span>车位号：'+ret.data.list[i].plotNo+'</span></div>'+
    '	<div>'+ret.data.list[i].parkName+'</div>'+
    	'<p>车牌号：'+ret.data.list[i].plateNo+'</p>'+
 			'</li>'
       $('#jyou').append(html)
    }

        $api.setStorage('j',0)

}

//html+='<div class="xiala"></div>'
//document.getElementById('content1').innerHTML=html;

}else {
// document.getElementById('content1').innerHTML='<img src="../../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:160px;margin-bottom:100px;">'
}

       }else {
         api.toast({
          msg:ret.info,
          duration: 2000,
          location: 'middle'
         });
     toast.hide()
       }


     }else {

      /* api.toast({
       msg: '网络错误',
       duration: 2000,
       location: 'middle'
   });*/
     }
toast.hide()
      })
}else {
  api.ajax({
    url: yuming+'/learun/adms/ParkingManagement/getparkinglist',
        method: 'get',
        data:{values: {
          "loginMark": api.deviceId,
          "token": $api.getStorage('token'),

          pageno	:page,
          pagesize	:20,
          name:str
              }}
       }, function(ret) {
 //alert(JSON.stringify(ret))
 api.refreshHeaderLoadDone()
         for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
          document.getElementsByClassName('zhuan')[i].style.display='none'
        }
        if(ret){
        if(ret.code==200){


 if(ret.data.list.length>0){
 var html='';
 for (var i = 0; i <ret.data.list.length; i++) {
 //  ' <div class="d" onclick="sjxq(1)">'+
 arr.push(ret.data.list[i])
 arrindex++
   if(1){
     html= '	<li onclick="cwxq('+arrindex+')" style="position:relative;">'+
        '<div><span>'+ret.data.list[i].name+'</span>'
  if(ret.data.list[i].parkingstatusid==1){  html+=    '<span style="color:#62E54D;">闲置</span></div>'}else {
    html+=    '<span style="color:#F2B721;" >租赁</span></div>'
  }
      html+='	<div>'+ret.data.list[i].remark+'</div>'
        html+='	<div style="width:100%;height:30px;position:relative"></div>'
        html+='	<img src="images/del.png" class="del vv" data-id="'+ret.data.list[i].id+'" onclick="shanchu('+ret.data.list[i].id+')" />'
      html+=	'</li>'
      $('#jzuo').append(html)
      $('.vv').click(function(e){

      　　e.stopPropagation();

      })
     }else {
       html= '	<li>'+
       '<div><span>楼层：'+ret.data.list[i].floorName+'</span><span>车位号：'+ret.data.list[i].plotNo+'</span></div>'+
     '	<div>'+ret.data.list[i].parkName+'</div>'+
     	'<p>车牌号：'+ret.data.list[i].plateNo+'</p>'+
  			'</li>'
        $('#jyou').append(html)
     }

         $api.setStorage('j',0)

 }

 //html+='<div class="xiala"></div>'
 //document.getElementById('content1').innerHTML=html;

 }else {
 // document.getElementById('content1').innerHTML='<img src="../../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:160px;margin-bottom:100px;">'
 }

        }else {
          api.toast({
           msg:ret.info,
           duration: 2000,
           location: 'middle'
          });
      toast.hide()
        }


      }else {

       /* api.toast({
        msg: '网络错误',
        duration: 2000,
        location: 'middle'
    });*/
      }
 toast.hide()
       })


}

}
zb()
$("#sou").on('keypress', function(e) {
  //  alert(1)
      var keycode = e.keyCode;
      //获取搜索框的值
      var neirong = $(this).val();

      if (keycode == '13') {
          e.preventDefault();
          //请求搜索接口
          if(0){
            api.toast({
            msg: '请输入搜索内容',
            duration: 2000,
            location: 'middle'
        });
          }else {
  str=neirong
page=0
showDefault()
$api.setStorage('j', 0);
zb()
              api.sendEvent({
                  name: 'sx',
                  extra: {
                    neirong: neirong
                  }
              });
            }

          }

  });
api.addEventListener({
name:'scrolltobottom',
extra:{
    threshold:0           //设置距离底部多少距离时触发，默认值为0，数字类型
}
}, function(ret, err){

if($api.getStorage('j')==0){
$api.setStorage('j',1)
//alert(1)
 var zhuan=document.getElementById('zhuan').cloneNode(true);
 zhuan.style.display='block'
 document.getElementById('ddd').appendChild(zhuan)

zb()
}
});
}
function shanchu(data){

  id=data
    $("#dialog").addClass("show");
}
function quxiao(data){

  //id=data
    $("#dialog").removeClass("show");
}
function queding(data){
/*
/learun/adms/Roomlease/deleleroomlease
*/
showDefault()
//alert(id)
      $("#dialog").removeClass("show");
		if(1){	api.ajax({
		    url: yuming+'/learun/adms/ParkingManagement/postparkingdelete',
		        method: 'post',
		        data:{values: {
		          "loginMark": api.deviceId,
		          "token": $api.getStorage('token'),
		        id	:id,

		              }}
		       }, function(ret) {
		 //alert(JSON.stringify(ret))
toast.hide()
		         for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
		          document.getElementsByClassName('zhuan')[i].style.display='none'
		        }
		        if(ret){
		        if(ret.code==200){
							api.toast({
							 msg:'删除成功!',
							 duration: 2000,
							 location: 'middle'
							});
api.sendEvent({
    name: 'sx',
    extra: {
        key1: 'value1',
        key2: 'value2'
    }
});



		        }else {
		          api.toast({
		           msg:ret.info,
		           duration: 2000,
		           location: 'middle'
		          });
		      toast.hide()
		        }


		      }else {

		       /* api.toast({
		        msg: '网络错误',
		        duration: 2000,
		        location: 'middle'
		    });*/
		      }
		 toast.hide()
	 })}else {
		 api.ajax({
 		    url: yuming+'/learun/adms/Roomdistribution/deleleroomdistribution',
 		        method: 'post',
 		        data:{values: {
 		          "loginMark": api.deviceId,
 		          "token": $api.getStorage('token'),
 		        id	:id,

 		              }}
 		       }, function(ret) {
 		 //alert(JSON.stringify(ret))
 toast.hide()
 		         for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
 		          document.getElementsByClassName('zhuan')[i].style.display='none'
 		        }
 		        if(ret){
 		        if(ret.code==200){
 							api.toast({
 							 msg:'删除成功!',
 							 duration: 2000,
 							 location: 'middle'
 							});
 api.sendEvent({
     name: 'sx',
     extra: {
         key1: 'value1',
         key2: 'value2'
     }
 });



 		        }else {
 		          api.toast({
 		           msg:ret.info,
 		           duration: 2000,
 		           location: 'middle'
 		          });
 		      toast.hide()
 		        }


 		      }else {

 		       /* api.toast({
 		        msg: '网络错误',
 		        duration: 2000,
 		        location: 'middle'
 		    });*/
 		      }
 		 toast.hide()
 	 })
	 }
}
function cwxq(data){
 api.openWin({
      name: 'cwxq2',
      url: './cwxq2.html',
      pageParam: {
          arr:arr[data-1]
      }
  });

}
</script>
