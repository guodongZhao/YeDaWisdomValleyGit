<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<meta name="format-detection" content="telephone=no"><!-- 禁止IPHONE识别手机号码 -->
<meta name="viewport" content="width=device-width,user-scalable=no, initial-scale=1">
<title>会议预约查询</title>
<!-- css -->
<link rel="stylesheet" type="text/css" href="css/index.css">
<link rel="stylesheet" type="text/css" href="css/mui.min.css" />
<link rel="stylesheet" href="css/calendar.css">
<link rel="stylesheet" type="text/css" href="../css/aui.css">

<script type="text/javascript" src="../script/api.js"></script>
<script type="text/javascript" src="../script/aui-toast.js"></script>
<script type="text/javascript" src="../script/H.js"></script>
<script type="text/javascript" src="../script/jquery.js"></script>
<script type="text/javascript" src="../script/yuming.js"></script>
<style>
.module-content{padding-top: 44px;margin-bottom: 50px;}
.yylist{padding: 10px;}
.yylist li{background: #fff;border-radius: 10px;padding: 5px 10px;margin-bottom: 10px;}
.yylist li .yytext{display: flex;justify-content: space-between;align-items: center;line-height: 22px;}
.yylist li .yyl{width: 60%;color: #000;font-size: 14px;}
.yylist li .yyl span{color: #25CB83;padding-top: 8px;}
.yylist li .yyr{color: #000;font-size: 14px;}
.yylist li .yyr span{color: #999;font-size: 14px;}
.hybz{display: flex;align-items: center; border-top: 1px solid #f1f1f1;line-height: 30px;font-size: 12px;color: #999;margin-top: 10px;}
.hybz img{margin-right: 10px;width: 16px;height: 16px;}
.zhuan{
	display: none;
	margin: 0 auto;
}
</style>
</head>
<body style="background: #f7f7f7;">

		<header id="headj">
			<a >
				<img src="images/back_jt.png" onclick="api.closeWin()" />
			<span onclick="api.closeWin()">会议预约查询</span>
		</a>
	</header>
<div class="module-content" id="ge">
	<ul class="yylist" id="jmenjin">
	<!--	<li>
			<div class="yytext">
				<p class="yyl">
					<b>10栋18楼1号会议室</b><br />
					<span style="color: #fe2400;">预约成功</span>
				</p>
				<p class="yyr">
					12月12日<br />
					<span>下午 14:00-16:00</span>
				</p>
			</div>
			<div class="hybz">
				<img src="images/bz.png" />
				<span>2019年信息化项目总结会</span>
			</div>
		</li>
		<li>
			<div class="yytext">
				<p class="yyl">
					<b>10栋18楼1号会议室</b><br />
					<span style="color: #25CB83;">已完成</span>
				</p>
				<p class="yyr">
					12月12日<br />
					<span>下午 14:00-16:00</span>
				</p>
			</div>
			<div class="hybz">
				<img src="images/bz.png" />
				<span>2019年信息化项目总结会</span>
			</div>
		</li>
		<li>
			<div class="yytext">
				<p class="yyl">
					<b>10栋18楼1号会议室</b><br />
					<span style="color: #25CB83;">已完成</span>
				</p>
				<p class="yyr">
					12月12日<br />
					<span>下午 14:00-16:00</span>
				</p>
			</div>
			<div class="hybz">
				<img src="images/bz.png" />
				<span>2019年信息化项目总结会</span>
			</div>
		</li>
		<li>
			<div class="yytext">
				<p class="yyl">
					<b>10栋18楼1号会议室</b><br />
					<span style="color: #fe2400;">预约成功</span>
				</p>
				<p class="yyr">
					12月12日<br />
					<span>下午 14:00-16:00</span>
				</p>
			</div>
			<div class="hybz">
				<img src="images/bz.png" />
				<span>2019年信息化项目总结会</span>
			</div>
		</li>
		<li>
			<div class="yytext">
				<p class="yyl">
					<b>10栋18楼1号会议室</b><br />
					<span style="color: #fe2400;">预约成功</span>
				</p>
				<p class="yyr">
					12月12日<br />
					<span>下午 14:00-16:00</span>
				</p>
			</div>
			<div class="hybz">
				<img src="images/bz.png" />
				<span>2019年信息化项目总结会</span>
			</div>
		</li>
	-->
	</ul>
</div>
<img src="../image/zhuan.gif" id="zhuan" style="height:20px;width:auto;margin-top:10px;margin-bottom:10px;" class="zhuan">
<div id="ddd">

</div>
<div class="foot_menu" style="display:none">
	<ul>
		<li>
			<a href="index.html">
				<i><img src="images/menu_icon01.png"></i>
				<span>首 页</span>
			</a>
		</li>
		<li class="cur">
			<a href="wuye.html">
				<i><img src="images/menu_icon02.png"></i>
				<span>智 能</span>
			</a>
		</li>
		<li>
			<a href="news.html">
				<i><img src="images/menu_icon03.png"></i>
				<span>消 息</span>
			</a>
		</li>
		<li>
			<a href="user.html">
				<i><img src="images/menu_icon04.png"></i>
				<span>我 的</span>
			</a>
		</li>
	</ul>
</div>
</body>
<script src="js/jquery.min.js"></script>
<script src="js/calendar.js"></script>

<!--方法调用-->
<script>
/*$('.room').datePicker({
	okFunc: function (date) {
		console.log(date);
	}
});*/
</script>
</html>
<script type="text/javascript">
arr=[]
page=0
type=1
ksdate=''
jsdate=''
apiready = function () {
$api.fixStatusBar(document.getElementById('headj'));
document.getElementById('headj').style.height=(50+api.safeArea.top)+'px'
document.getElementById('ge').style.marginTop=(5+api.safeArea.top)+'px'
api.addEventListener({
    name: 'sxrw'
}, function(ret, err){
  showDefault()
	page=0;
	zb()
});

    // $("#dialog").addClass("show");
/*获取当前时间*/
   var time = new Date();
   /*格式化日，如果小于9，则补0*/
   var day = ("0" + time.getDate()).slice(-2);
   /*格式化月，如果小于9，则补0*/
   var month = ("0" + (time.getMonth() + 1)).slice(-2);
   /*拼接日期*/
   var today = time.getFullYear() + "-" + (month) + "-" + (day);
   /*完成赋值操作*/
   ksdate=today
   jsdate=today

  // alert( document.getElementById("jsdate").value)
$api.setStorage('j',0)
showDefault()
api.addEventListener({
    name: 'sx'
}, function(ret, err){
	page=0;
  showDefault()
  zb()
});

function zb(){

page++
if(page==1){
//alert(riqi)
//alert()
/*/learun/adms/Appointment/getappointment
类型：Post
参数名称	类型	备注	必须
loginMark	String	设备标识，必须具有唯一性	是
token	String	验证码，从登录后返回信息中获取	是
pageno	String	当前页码	是
pagesize	String	每页记录数	是
StartTime	Datetime	开始时间,三项都不填写查询全部
EndTime	Datetime	结束时间,三项都不填写查询全部
ConferenceName	String	会议室名称,三项都不填写查询全部
请求参数：
返回参数：
参数名称	类型	备注
code	String	结果响应码
info	String	结果响应信息
data	String	返回值
data主要属性：
参数名称	类型	备注
pageno	String	当前页码
pagesize	String	每页记录数
total	String	总记录数
list	List<Map>	列表

List主要属性
参数名称	类型	备注
ID	String	Id
Liaison	String	联系人
PhoneNumber	String	电话
CompanyName	String	申请公司
ConferenceName	String	会议室名称
Reason	String	申请用途
Status2	String	会议室地址
StartTime	DateTime	开始时间
EndTime	DateTome	结束时间
ConferenceID	String	会议室id
CompanyID	String	申请公司id*/
 api.ajax({
	 url: yuming+'/learun/adms/Appointment/getappointment',
			 method: 'get',
			 data:{values: {


"loginMark": api.deviceId,
"token": $api.getStorage('token'),
pageno:page,
pagesize:10,

						 }}
			}, function(ret) {
//alert(JSON.stringify(ret))
api.refreshHeaderLoadDone()
				for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
				 document.getElementsByClassName('zhuan')[i].style.display='none'
			 }
			 if(ret){
			 if(1){


if(ret.data.list.length>0){
var html='';
for (var i = 0; i <ret.data.list.length; i++) {
html+='	<li>'
	html+=	'<div class="yytext">'
	html+=	'	<p class="yyl">'
		html+=	'	<span style="color:#464646">'+ret.data.list[i].Status2+ret.data.list[i].ConferenceName+'</span><br />'
		html+=		'<span style="color: #fe2400;">预约成功</span>'
	html+='		</p>'
		html+='	<p class="yyr">'
	html+=		ret.data.list[i].StartTime.split('-')[1]+'月'	+ret.data.list[i].StartTime.split('-')[2].split(' ')[0]+'日<br />'
		html+=	'	<span>'+ret.data.list[i].StartTime.split(' ')[1].split(':')[0]+':'+ret.data.list[i].StartTime.split(' ')[1].split(':')[1]+'-'+ret.data.list[i].EndTime.split(' ')[1].split(':')[0]+':'+ret.data.list[i].EndTime.split(' ')[1].split(':')[1]+'</span>'
		html+='	</p>'
	html+='	</div>'
html+=	'	<div class="hybz">'
	html+=	'	<img src="images/bz.png" />'
	html+=	'	<b style="color:black">'+ret.data.list[i].Reason+'</b>'
	html+=	'</div>'
html+='	</li>'
}
html+='<div class="xiala"></div>'
document.getElementById('jmenjin').innerHTML=html;
$('.vv').click(function(e){

　　e.stopPropagation();

})
}else {
 document.getElementById('jmenjin').innerHTML='<img src="../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:160px;margin-bottom:100px;">'
}

			 }else {

		 toast.hide()
			 }


		 }else {

			/* api.toast({
			 msg: '网络错误',
			 duration: 2000,
			 location: 'middle'
	 });*/
		 }
toast.hide()
			})
}else {
 api.ajax({
	 url: yuming+'/learun/adms/Appointment/getappointment',
			 method: 'get',
			 data:{values: {


"loginMark": api.deviceId,
"token": $api.getStorage('token'),
pageno:page,
pagesize:10,
					}}
}, function(ret) {
				for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
				 document.getElementsByClassName('zhuan')[i].style.display='none'
			 }
			 if(ret){
			 if(1){


         if(ret.data.list&&ret.data.list.length>0){
         var html='';
         for (var i = 0; i <ret.data.list.length; i++) {
					 html+='	<li>'
					 	html+=	'<div class="yytext">'
					 	html+=	'	<p class="yyl">'
						html+=	'	<span style="color:#464646">'+ret.data.list[i].Status2+ret.data.list[i].ConferenceName+'</span><br />'
				 		html+=		'<span style="color: #fe2400;">预约成功</span>'
				 	html+='		</p>'
				 		html+='	<p class="yyr">'
				 	html+=		ret.data.list[i].StartTime.split('-')[1]+'月'	+ret.data.list[i].StartTime.split('-')[2].split(' ')[0]+'日<br />'
				 		html+=	'	<span>'+ret.data.list[i].StartTime.split(' ')[1].split(':')[0]+':'+ret.data.list[i].StartTime.split(' ')[1].split(':')[1]+'-'+ret.data.list[i].EndTime.split(' ')[1].split(':')[0]+':'+ret.data.list[i].EndTime.split(' ')[1].split(':')[1]+'</span>'
				 		html+='	</p>'
				 	html+='	</div>'
				 html+=	'	<div class="hybz">'
				 	html+=	'	<img src="images/bz.png" />'
				 	html+=	'	<b style="color:black">'+ret.data.list[i].Reason+'</b>'
					 	html+=	'</div>'
					 html+='	</li>'
         }

html+='<div class="xiala"></div>'
document.getElementsByClassName('xiala')[page-2].innerHTML=html
	$api.setStorage('j',0)
  $('.vv').click(function(e){

  　　e.stopPropagation();

  })
}else {
 //document.getElementById('content').innerHTML='<img src="../image/zanwu.png"style="width:100px;height:100px;display:block;margin:0 auto;margin-top:100px;">'
}

			 }


		 }else {

			/* api.toast({
			 msg: '网络错误',
			 duration: 2000,
			 location: 'middle'
	 });*/
		 }
toast.hide()
			})


}

}
zb()
api.addEventListener({
name:'scrolltobottom',
extra:{
		threshold:0           //设置距离底部多少距离时触发，默认值为0，数字类型
}
}, function(ret, err){

if($api.getStorage('j')==0){
$api.setStorage('j',1)
//alert(1)
 var zhuan=document.getElementById('zhuan').cloneNode(true);
 zhuan.style.display='block'
 document.getElementById('ddd').appendChild(zhuan)

zb()
}
});


}
function fwxq(data){
	//alert(JSON.stringify(arr[data]))
	api.openWin({
	    name: 'rwxq',
	    url: './rwxq.html',
	    pageParam: {
	      id:data.getAttribute('data-id'),
          id2:data.getAttribute('data-id2')
	    }
	});

}
function renwu(data,th){
  var ding=document.getElementsByClassName('ding');
  for (var i = 0; i < ding.length; i++) {
    ding[i].classList.remove('dingac')
  }
  th.classList.add('dingac')
  type=data
  page=0
  api.sendEvent({
      name: 'sx',
      extra: {
          key1: 'value1',
          key2: 'value2'
      }
  });

}
function tongguo(data){

  id=data.getAttribute('data-id')
    $("#dialog").addClass("show");
}
function jujue(data){

  id=data.getAttribute('data-id')
    $("#dialog2").addClass("show");
}
function queding(data){
/*
求地址：/learun/adms/task/audit
类型：POST
请求参数：
参数名称	类型	备注	必须
loginMark	String	设备标识，必须具有唯一性	是
token	String	验证码，从登录后返回信息中获取	是
taskid	String	任务id（获取任务列表接口中返回）	是
verifytype	String	1同意，2不同意	是
description	String	备注意见	否
*/
showDefault()
//alert(id)
      $("#dialog").removeClass("show");
			api.ajax({
		    url: yuming+'/learun/adms/task/audit',
		        method: 'post',
		        data:{values: {
		          "loginMark": api.deviceId,
		          "token": $api.getStorage('token'),
		        taskid	:id,
		        verifytype:1,
						description:document.getElementById('bz').value
		              }}
		       }, function(ret) {
		 //alert(JSON.stringify(ret))
toast.hide()
		         for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
		          document.getElementsByClassName('zhuan')[i].style.display='none'
		        }
		        if(ret){
		        if(ret.code==200){
							api.toast({
							 msg:'审核通过!',
							 duration: 2000,
							 location: 'middle'
							});
api.sendEvent({
    name: 'sxrw',
    extra: {
        key1: 'value1',
        key2: 'value2'
    }
});



		        }else {
		          api.toast({
		           msg:ret.info,
		           duration: 2000,
		           location: 'middle'
		          });
		      toast.hide()
		        }


		      }else {

		       /* api.toast({
		        msg: '网络错误',
		        duration: 2000,
		        location: 'middle'
		    });*/
		      }
		 toast.hide()
		       })
}
function queding2(data){

showDefault()
      $("#dialog2").removeClass("show");
			api.ajax({
		    url: yuming+'/learun/adms/task/audit',
		        method: 'post',
		        data:{values: {
		          "loginMark": api.deviceId,
		          "token": $api.getStorage('token'),
		        taskid	:id,
		        verifytype:2,
						description:document.getElementById('bz').value
		              }}
		       }, function(ret) {
		 //alert(JSON.stringify(ret))
toast.hide()
		         for (var i = 0; i < document.getElementsByClassName('zhuan').length; i++) {
		          document.getElementsByClassName('zhuan')[i].style.display='none'
		        }
		        if(ret){
		        if(ret.code==200){
							api.toast({
							 msg:'审核拒绝!',
							 duration: 2000,
							 location: 'middle'
							});
						api.sendEvent({
						    name: 'sxrw',
						    extra: {
						        key1: 'value1',
						        key2: 'value2'
						    }
						});



		        }else {
		          api.toast({
		           msg:ret.info,
		           duration: 2000,
		           location: 'middle'
		          });
		      toast.hide()
		        }


		      }else {

		       /* api.toast({
		        msg: '网络错误',
		        duration: 2000,
		        location: 'middle'
		    });*/
		      }
		 toast.hide()
		       })
}
function quxiao(data){


    $("#dialog").removeClass("show");
}
function quxiao2(data){


    $("#dialog2").removeClass("show");
}
</script>
